<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
	<link rel="styleSheet" href="../../css/framework/table.css?v=1.0.1">
	<link rel="styleSheet" href="../../css/framework/module.css?v=1.0.1">
    <base href="./">
	<title>公司信息</title>
</head>
<body>
	<form action="" method="POST">
		<div class="module" style="width: 100%;">
			<div class="title">
	    		<div class="item selected" v-cloak>公司信息{{PAGETITLE}}</div>	
	    	</div>
	    	<div class="content">
	    		<div class="item selected" style="padding:10px;">    			
	  				<table class="detailTable" border="1">
						<tr>
							<th width="20%">公司名称</th>
							<td width="30%">
								<input type="text" name="name" title="公司名称" class="null" v-model="name" v-cloak v-if="!ISDETAIL">
								<span v-cloak v-else>{{name}}</span>
							</td>
							<th width="20%">中文简称</th>
							<td width="30%">
								<input type="text" name="abbr" title="中文简称" class="null" v-model="abbr" v-cloak v-if="!ISDETAIL">
								<span v-cloak v-else>{{abbr}}</span>
							</td>
						</tr>
						<tr>
							<th width="20%">类型</th>
							<td width="30%">
								<select name="typeId" v-model="typeId" v-cloak v-if="!ISDETAIL">
									<option></option>
									<option v-for="s in TYPES" :value="s.id">{{s.name}}</option>
								</select>
								<span v-cloak v-else>{{typeName}}</span>
							</td>
							<th width="20%">品牌标识</th>
							<td width="30%">
								<select name="brandId" v-model="brandId" v-cloak v-if="!ISDETAIL">
									<option></option>
									<option v-for="s in BRANDS" :value="s.id">{{s.name}}</option>
								</select>
								<span v-cloak v-else>{{brandId}}</span>
							</td>
						</tr>
						<tr>
							<th width="20%">防伪类型</th>
							<td width="30%">
								<select name="verifyTypeId" v-model="verifyTypeId" v-cloak v-if="!ISDETAIL">
									<option></option>
									<option v-for="s in VERIFYTYPES" :value="s.id">{{s.name}}</option>
								</select>
								<span v-cloak v-else>{{verifyTypeName}}</span>
							</td>
							<th width="20%">注册时间</th>
							<td width="30%">
								<input type="text" name="regTime" class="Wdate" :change="change(this)" onFocus="WdatePicker({lang:'zh-cn',dateFmt:'yyyy-MM-dd',readOnly:true})" v-model="regTime" v-cloak v-if="!ISDETAIL">
								<span v-cloak v-else>{{regTime}}</span>
							</td>
						</tr>
						<tr>
							<th width="20%">注册地址</th>
							<td width="30%">
								<input type="text" name="regAddress" v-model="regAddress" v-cloak v-if="!ISDETAIL">
								<span v-cloak v-else>{{regAddress}}</span>
							</td>
							<th width="20%">经营范围</th>
							<td width="30%">
								<input type="text" name="busniessScop" v-model="busniessScop" v-cloak v-if="!ISDETAIL">
								<span v-cloak v-else>{{busniessScop}}</span>
							</td>
						</tr>
						<tr>
							<th width="20%">联系电话</th>
							<td width="30%">
								<input type="text" name="tel" title="联系电话" class="phone" v-model="tel" v-cloak v-if="!ISDETAIL">
								<span v-cloak v-else>{{tel}}</span>
							</td>
							<th width="20%">售后电话</th>
							<td width="30%">
								<input type="text" name="serviceTel" title="售后电话" class="phone" v-model="serviceTel" v-cloak v-if="!ISDETAIL">
								<span v-cloak v-else>{{serviceTel}}</span>
							</td>
						</tr>
						<tr>
							<th width="20%" height="50">图片</th>
							<td width="30%" colspan="3" style="padding: 5px">
								<div id="image"></div>
								<button @click="upload('image')" class="myBtn btn-primary" v-cloak v-if="!ISDETAIL">上传图片</button>
							</td>
						</tr>
						<tr style="height:200px;">
							<th width="20%" height="50">描述</th>
							<td width="30%" colspan="3" style="height: 200px;">
								<textarea name="des" style="height: 100%;width: 98%;" v-model="des" :readonly="ISDETAIL"></textarea>
							</td>
						</tr>
	  				</table>		
	    		</div>
	    		<div class="submit" v-if="PAGETYPE != 'detail'">
	    		    <center>
	    		    	<input type="button" class="saveBtn" value="保存">
	    		    </center>
	    		</div>
	    	</div>
		</div>
	</form>

	<script src="../../js/jquery/jquery-1.8.3.min.js?v=1.0.1"></script>
	<script src="../../plugins/Vue/Vue.js?v=1.0.1"></script>
	<script src="../../plugins/My97DatePicker/WdatePicker.js?v=1.0.1"></script>
	<script src="../../plugins/AjaxUploader-0.0.1.js?v=1.0.1"></script>
	<script src="../../js/framework/table.js?v=1.0.1" ></script>
	<script src="../../js/default.js?v=1.0.1"></script>
	<script>
		var vmParam = $.extend(true, VMDEFAULT, {
			data: {
				name:"",
				abbr:"",
				typeName:"",
				typeId: "",
				brandId:"",
				verifyTypeId:"",
				verifyTypeName: "",
				regTime:"",
				regAddress:"",
				busniessScop:"",
				image: "",
				tel:"",
				serviceTel:"",
				des:"",
				TYPES: [],
				BRANDS: [],
				VERIFYTYPES:[]
			},
			computed: {
				ACTION: function(){
					switch(TYPE){
						case "edit":
							return "meta/supplier/update/"+getRequest("id");
						case "detail":
							return "meta/supplier/get/"+getRequest("id");
						default:
							return "meta/supplier/add";
					}
				}
			},
			methods: {
				formdata: function(){
					var data = {
						image: this.image,
						verifyTypeName: $("[name='verifyTypeId'] option:selected").text(),
						typeName: $("[name='typeId'] option:selected").text()
					};
					return data;
				},
				change: function(input){
					this.regTime = $("[name='regTime']").val();
				},
				upload: function(ms, event){
					var _this = this;
					new AjaxUploader({
    					url: _this.uploadBase,
    					name: "file",
    					before: function(file){
    						//验证
    						return _this.pictureCheck(file);
    					},
    					callBack:function(result){
        					//处理结果，显示预览
    						if(result && result.data){
    							for(var i=0;i<result.data.length;i++){
    								_this.createFilePicture(result.data, ms);
    							}
    						}
    					}
    				});
				},
				getBrand: function(){
					var _this = this;
					var param = {
						pageSize: 100
					};
					junAjax({
						url: vm.basePathB+"meta/brand",
						type: "POST",
						contentType:'application/json',
						data: JSON.stringify(param),
						processData: false,
						success: function(result){
							if(result.code != "200"){
								alert(result.data);
							}else{
								for(var i=0; i<result.data.length; i++){
									_this.$set(_this.BRANDS, i, {
										name: result.data[i].name,
										id: result.data[i].id
									});
								}
							}
						},
						error: function(){
							alert("网络错误 ！");
						}
					});
				}
			}
		});
		var vm = new Vue(vmParam);
		$("form").attr("action", vm.basePathB+vm.ACTION);
		if(TYPE != "detail"){
			vm.getBrand();
		}
		if(TYPE != null){
			junAjax({
				url: vm.basePathB+"meta/supplier/get/"+getRequest("id"),
				success: function(result){
					if(result.code != "200"){
						alert(result.data);
					}else{
						for(data in result.data){
							vm[data] = result.data[data];
						}

						if(typeof vm.image != "undefined" && vm.image != ""){
							vm.createFilePicture([vm.image], "image", {type: vm.PAGETYPE});
						}
					}
				},
				error: function(){
					alert("网络错误 ！");
				}
			});
		}
		
	</script>
</body>
</html>

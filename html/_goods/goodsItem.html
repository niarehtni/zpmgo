<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="styleSheet" href="../../css/framework/table.css?v=1.0.1">
    <link rel="styleSheet" href="../../css/framework/module.css?v=1.0.1">
    <base href="./">
    <title>商品信息</title>
</head>
<body>
<form action="" method="POST">
    <div class="module" style="width: 100%;">
        <div class="title">
            <div class="item selected" v-cloak>商品信息{{PAGETITLE}}</div>
        </div>
        <div class="content">
            <div class="item selected" style="padding:10px;">
                <table class="detailTable" border="1">
                    <tr>
                        <th width="20%">商品名称</th>
                        <td width="30%">
                            <input type="text" name="name" title="商品名称" class="null" v-model="name" v-cloak v-if="!ISDETAIL">
                            <span v-cloak v-else>{{name}}</span>
                        </td>
                        <th width="20%">产品唯一标识</th>
                        <td width="30%">
                            <select name="productId" v-model="productId" v-cloak v-if="!ISDETAIL">
                                <option></option>
                                <option v-for="s in PRODUCTS" :value="s.id">{{s.name}}</option>
                            </select>
                            <span v-cloak v-else>{{productId}}</span>
                        </td>
                    </tr>
                    <tr>
                        <th width="20%">卖家唯一标识</th>
                        <td width="30%">
                            <input type="text" name="sellerId" v-model="sellerId" v-cloak v-if="!ISDETAIL">
                            <span v-cloak v-else>{{sellerId}}</span>
                        </td>
                        <th width="20%">价格</th>
                        <td width="30%">
                            <input type="text" name="price" title="价格" class="null plus" v-model="price" v-cloak v-if="!ISDETAIL">
                            <span v-cloak v-else>{{price}}</span>
                        </td>
                    </tr>
                    <tr>
                        <th width="20%">销量</th>
                        <td width="30%">
                            <input type="text" name="sold" v-model="sold" title="销量" class="plus integer" v-cloak v-if="!ISDETAIL">
                            <span v-cloak v-else>{{sold}}</span>
                        </td>
                        <th width="20%">总库存</th>
                        <td width="30%">
                            <input type="text" name="stock" v-model="stock" title="总库存" class="plus integer" v-cloak v-if="!ISDETAIL">
                            <span v-cloak v-else>{{stock}}</span>
                        </td>
                    </tr>
                    <tr>
                        <th width="20%">规格一名称</th>
                        <td width="30%">
                            <input type="text" name="firstName" v-model="firstName" v-cloak v-if="!ISDETAIL">
                            <span v-cloak v-else>{{firstName}}</span>
                        </td>
                        <th width="20%">规格一选项</th>
                        <td width="30%">
                            <input type="text" v-model="first" v-cloak v-if="!ISDETAIL">
                            <span v-cloak v-else>{{first}}</span>
                        </td>
                    </tr>
                    <tr>
                        <th width="20%">规格二名称</th>
                        <td width="30%">
                            <input type="text" name="secondName" v-model="secondName" v-cloak v-if="!ISDETAIL">
                            <span v-cloak v-else>{{secondName}}</span>
                        </td>
                        <th width="20%">规格二选项</th>
                        <td width="30%">
                            <input type="text" v-model="second" v-cloak v-if="!ISDETAIL">
                            <span v-cloak v-else>{{second}}</span>
                        </td>
                    </tr>
                    <tr>
                        <th width="20%">规格三名称</th>
                        <td width="30%">
                            <input type="text" name="thirdName" v-model="thirdName" v-cloak v-if="!ISDETAIL">
                            <span v-cloak v-else>{{thirdName}}</span>
                        </td>
                        <th width="20%">规格三选项</th>
                        <td width="30%">
                            <input type="text" v-model="third" v-cloak v-if="!ISDETAIL">
                            <span v-cloak v-else>{{third}}</span>
                        </td>
                    </tr>
                    <tr>
                        <th width="20%" height="50">二维码</th>
                        <td width="30%" colspan="3" style="padding: 5px">
                            <div id="barcode"></div>
                            <button @click="upload('barcode')" class="myBtn btn-primary" v-cloak v-if="!ISDETAIL">上传图片</button>
                        </td>
                    </tr>
                    <tr>
                        <th width="20%" height="50">大图</th>
                        <td width="30%" colspan="3" style="padding: 5px">
                            <div id="image"></div>
                            <button @click="upload('image')" class="myBtn btn-primary" v-cloak v-if="!ISDETAIL">上传图片</button>
                        </td>
                    </tr>
                    <tr>
                        <th width="20%" height="50">小图</th>
                        <td width="30%" colspan="3" style="padding: 5px">
                            <div id="icon"></div>
                            <button @click="upload('icon')" class="myBtn btn-primary" v-cloak v-if="!ISDETAIL">上传图片</button>
                        </td>
                    </tr>
                    <tr>
                        <th width="20%" height="50">多张图</th>
                        <td width="30%" colspan="3" style="padding: 5px">
                            <div id="images"></div>
                            <button @click="upload('images')" class="myBtn btn-primary" v-cloak v-if="!ISDETAIL">上传图片</button>
                        </td>
                    </tr>
                    <tr style="height:200px;">
                        <th width="20%" height="50">简介</th>
                        <td width="30%" colspan="3" style="height: 200px;">
                            <textarea name="desc" style="height: 100%;width: 98%;" v-model="des" :readonly="ISDETAIL"></textarea>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="submit">
                <center>
                    <input type="button" class="saveBtn" value="保存">
                </center>
            </div>
        </div>
    </div>
</form>

<script src="../../js/jquery/jquery-1.8.3.min.js?v=1.0.1"></script>
<script src="../../plugins/Vue/Vue.js?v=1.0.1"></script>
<script src="../../plugins/AjaxUploader-0.0.1.js?v=1.0.1"></script>
<script src="../../js/framework/table.js?v=1.0.1" ></script>
<script src="../../js/default.js?v=1.0.1"></script>
<script>
    var vmParam = $.extend(true, VMDEFAULT, {
        data: {
            productId:"",
            sellerId: "",
            name: "",
            des: "",
            price: "",
            sold: "",
            stock: "",
            barcode: "",
            icon: "",
            image: "",
            images:[],
            firstName: "",
            secondName: "",
            thirdName: "",
            first: [],
            second: [],
            third: [],
            PRODUCTS: []
        },
        computed: {
            ACTION: function(){
                switch(TYPE){
                    case "edit":
                        return "meta/goods/update/"+getRequest("id");
                    case "detail":
                        return "meta/goods/get/"+getRequest("id");
                    default:
                        return "meta/goods/add";
                }
            }
        },
        methods: {
            formdata: function(){
                var data = {
                    image: this.image,
                    icon: this.icon,
                    images: this.images,
                    barcode: this.barcode
                };
                if("[object Array]" === Object.prototype.toString.call(this.first)){
                    data["first"] = this.first;
                }else{
                    data["first"] = this.first.split(",");
                }
                if("[object Array]" === Object.prototype.toString.call(this.second)){
                    data["second"] = this.second;
                }else{
                    data["second"] = this.second.split(",");
                }
                if("[object Array]" === Object.prototype.toString.call(this.third)){
                    data["third"] = this.third;
                }else{
                    data["third"] = this.third.split(",");
                }
                return data;
            },
            upload: function(ms, event){
                var _this = this;
                new AjaxUploader({
                    url: _this.uploadBase,
                    name: "file",
                    before: function(file){
                        //验证
                        return _this.pictureCheck(file);
                    },
                    callBack:function(result){
                        //处理结果，显示预览
                        if(result && result.data){
                            for(var i=0;i<result.data.length;i++){

                                if("image" == ms){
                                //大图
                                    _this.createFilePicture(result.data, ms);
                                    if("" == _this["icon"]){
                                        _this.createFilePicture(result.data, "icon", {size:60});
                                    }
                                    if(!_this["images"].length){
                                        _this.createFilePicture(result.data, "images", {multiple:true});
                                    }
                                }else if("icon" == ms){
                                //小图
                                    _this.createFilePicture(result.data, ms, {size:60});
                                }else if("images" == ms){
                                //多张图
                                    _this.createFilePicture(result.data, ms, {multiple: true});
                                }else if("barcode" == ms){
                                //二维码
                                    _this.createFilePicture(result.data, ms);
                                }
                            }
                        }
                    }
                });
            },
            getProduct: function(){
                var _this = this;
                var param = {
                    pageSize: 1000
                };
                junAjax({
                    url: vm.basePathB+"meta/product?_="+new Date().getTime(),
                    type: "POST",
                    contentType:'application/json',
                    data: JSON.stringify(param),
                    processData: false,
                    success: function(result){
                        if(result.code != "200"){
                            alert(result.data);
                        }else{
                            for(var i=0; i<result.data.length; i++){
                                _this.$set(_this.PRODUCTS, i, {
                                    name: result.data[i].name,
                                    id: result.data[i].id
                                });
                            }
                        }
                    },
                    error: function(){
                        alert("网络错误 ！");
                    }
                });
            }
        }
    });
    var vm = new Vue(vmParam);
    $("form").attr("action", vm.basePathB+vm.ACTION);
    if(TYPE != "detail"){
        vm.getProduct();
    }
    if(TYPE != null){
        junAjax({
            url: vm.basePathB+"meta/goods/get/"+getRequest("id"),
            success: function(result){
                if(result.code != "200"){
                    alert(result.data);
                }else{
                    for(data in result.data){
                        vm[data] = result.data[data];
                    };
                    vm.first = vm.first.length ? vm.first.join() : "";
                    vm.second = vm.second.length ? vm.second.join() : "";
                    vm.third = vm.third.length ? vm.third.join() : "";

                    if(typeof vm.barcode != "undefined" && vm.barcode != ""){
                    //二维码
                        vm.createFilePicture([vm.barcode], "barcode", {type: vm.PAGETYPE});
                    }
                    if(typeof vm.image != "undefined" && vm.image != ""){
                    //大图
                        vm.createFilePicture([vm.image], "image", {type: vm.PAGETYPE});
                    }
                    if(typeof vm.icon != "undefined" && vm.icon != ""){
                    //小图
                        vm.createFilePicture([vm.icon], "icon", {size:60, type: vm.PAGETYPE});
                    }
                    if(typeof vm.images != "undefined" && vm.images.length){
                    //多张图
                        vm.createFilePicture(vm.images, "images", {multiple: true, type: vm.PAGETYPE});
                    }
                }
            },
            error: function(){
                alert("网络错误 ！");
            }
        });
    }
    
</script>
</body>
</html>

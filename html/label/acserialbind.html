<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="stylesheet" href="../../css/jquery/jquery.flexigrid.css?v=1.0.1">
    <link rel="stylesheet" href="../../css/jquery/jquery.alerts.css?v=1.0.1">
    <base href="./">
	<title>标签绑定</title>
</head>
<body>
	<form action="../../data/acserialbind" method="get">
		<table class="searchTable">
			<tbody>
				<tr>
					<td>标签序号</td>
  					<td style="padding-left:10px">
  						<input type="text" name="serialNoStart" id="serialNoStart" value="">--
  						<input type="text" name="serialNoEnd" id="serialNoEnd" value="">
  					</td>
  					<td>订单编号</td>
  					<td style="padding-left:10px">
  						<input type="text" name="" id="orderCode" value="">
  					</td>
  					<td>购买公司</td>
  					<td style="padding-left:10px">
  						<select name="">
  							<option value=""></option>
  						</select>
  					</td>				
  				</tr>
			</tbody>
		</table>
	</form>
	<table class="listTable"></table>

	<script src="../../js/jquery/jquery-1.8.3.min.js?v=1.0.1"></script>
	<script src="../../js/jquery/jquery.flexigrid.js?v=1.0.1"></script>
	<script src="../../js/jquery/jquery.alerts.js?v=1.0.1"></script>
	<script>
	$(function(){
		$("table.listTable").flexigrid(GRID);	
	});	
	var GRID = {
		form: $("form"),
        //sortname: "",
        //sortorder: "",
        primaryKey: "id",
        showCheckBox: false,
        colModel: [
        	{display: "标签序号", name: "serialNo", width: "15%", sortable: true},
			{display: "购买公司", name: "orgName", width: "15%", sortable: true},
			{display: "订单编号", name: "orderCode", width: "15%", sortable: true},
			{display: "标签类型", name: "typeName", width: "15%", sortable: true},
			{display: "产品名称", name: "productName", width: "15%", sortable: true},
			{display: "产品规格", name: "standard", width: "15%", sortable: true},
			{display: "操作", name: "bindAmount", width: "10%", 
				dataFormat: function(value, td, row){
					return "<span class='editBtn' onclick='bind(this)' title='单个绑定'></span>";
				}
			}
        ],
        buttons:[{
            name: "批量绑定",
            bclass: "editBtn",
            onpress: function(g){
            	var serialNoStart = $("#serialNoStart").val();
            	var serialNoEnd = $("#serialNoEnd").val();
            	if(serialNoStart == "" && serialNoEnd == ""){
            		jAlert("请先选择起止标签序号");
            		return;
            	}
                bindOpr({
                    url: "../html/label/acserialbindItem.html?serialNoStart="+serialNoStart+"&serialNoEnd="+serialNoEnd,
                    name: "绑定标签",
                    success : function() {},
                    error : function() {}
                },g);
          	}
        },{
            name: "订单绑定",
            bclass: "editBtn",
            onpress: function(g){
            	var orderCode = $("#orderCode").val();
            	if(orderCode == ""){
            		jAlert("请先选择订单编号");
            		return;
            	}
                bindOpr({
                    url: "../html/label/acserialbindItem.html?orderCode="+orderCode,
                    name: "绑定订单标签",
                    success : function() {},
                    error : function() {}
                },g);
          	}
        }]
	};

	function bind(obj){
		var serialNo = $(obj).parents("td").siblings("[abbr='serialNo']").find("div").text();
		bindOpr({
			url: "../html/label/acserialbindItem.html?serialNo="+serialNo,
			name: "绑定标签"
		}, obj);
	}

	function bindOpr(jsonObj, g){
		jsonObj = $.extend( {
			url : false,
			success : function() {},
            error : function() {}
		}, jsonObj);

		var url = jsonObj.url;
		if (url.indexOf("?") > 0) {
			url = url + "&time=" + new Date().getTime();
		} else {
			url = url + "?time=" + new Date().getTime();
		}
		
		top.addTab({href:url,name:jsonObj.name,closeCallBack:function(result){
			if(result.code == "200"){
				jsonObj.success();
				$(".listTable").flexReload( {});
			}else{
				jsonObj.error();
			}
		},closeCheckBefore:function(){return confirm("是否确定关闭？")}});
	}
	</script>
</body>
</html>
